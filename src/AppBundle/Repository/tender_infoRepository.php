<?php

namespace AppBundle\Repository;

use Doctrine\ORM\EntityRepository;

/**
 * tender_infoRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */
class tender_infoRepository extends EntityRepository
{
    
    public function findOneByWhere($link,$title) {
        $baseSql = 'SELECT a FROM AppBundle:tender_info a  WHERE a.link = :link and a.title = :Title';
        $query = $this->getEntityManager()->createQuery($baseSql)
            ->setParameter("link", $link)
            ->setParameter("Title",  $title)
            ->getResult();
        return $query ;
    }
    
    
     public function findCountByType($type) {
        $baseSql = 'SELECT COUNT(a.area) as value,TRIM(a.area) as name FROM AppBundle:tender_info a WHERE a.type = :type group by a.area';
        $query = $this->getEntityManager()->createQuery($baseSql)
            ->setParameter("type",  $type)
            ->getResult();
        return $query ;
    }
    
    public function findCountByNetPurchase() {
        $baseSql = 'SELECT COUNT(a.area) as value,TRIM(a.area) as name FROM AppBundle:tender_info a  group by a.area ORDER BY value DESC';
        $query = $this->getEntityManager()->createQuery($baseSql)
                 ->getResult();
        return $query ;
    }
    
    public function findCountByTime($starttime,$endtime) {
        $baseSql = 'SELECT COUNT(a.area) as value,TRIM(a.area) as name FROM AppBundle:tender_info a WHERE a.createtime BETWEEN :starttime AND :endtime  group by a.area ORDER BY value DESC';
        $query = $this->getEntityManager()->createQuery($baseSql)
                 ->setParameter("starttime",  $starttime)
                 ->setParameter("endtime",  $endtime)
                 ->getResult();
        return $query ;
    }
    
    
   
}
