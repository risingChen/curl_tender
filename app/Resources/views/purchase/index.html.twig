{% extends 'base.html.twig' %}
{% block title %}招标查询系统{% endblock %}
{% block stylesheets %}
    <script type="text/javascript" src="//cdn.jsdelivr.net/jquery/1/jquery.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>

    <script type="text/javascript" src="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.js"></script>
    <link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/bootstrap.daterangepicker/2/daterangepicker.css" />
{% endblock %}
{% block body %}
    <div>
        <nav class="navbar navbar-inverse" role="navigation">
            <div class="container-fluid">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <a class="navbar-brand" href="{{ path('purchase_charts') }}">图表</a>
                </div>
            </div><!-- /.container-fluid -->
        </nav>
    </div>
    <div class="panel panel-default">
        <div class="panel-body">
            <div id="msg_hint" class="alert alert-success" role="alert" style="display:none">
                <strong>Well done!</strong> data insert success.
            </div>
            <form role="form">
                <div class="form-group">
                    <label for="exampleInputEmail1">keyword</label>
                    <input type="email" class="form-control" id="keyword" placeholder="keyword">
                </div>
                <div class="form-group">
                    <label for="exampleInputPassword1">date section</label>
                    <input type="text" class="form-control" name="daterange" placeholder="date picker">
                </div>
                <div class="form-group">
                    <label for="exampleInputPassword1">Pagesize</label>
                    <input type="text" class="form-control" id="pagesize" placeholder="Pagesize">
                </div>

                <button type="button" id="gotoCatch" class="btn btn-default">search</button>
            </form>
        </div>
    </div>
    <div class="progress" style="display:none;">
        <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="50" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
        </div>
    </div>
    <div id="confirm" class="panel panel-default" style="display:none;">
        <div class="panel-body">
            是否需要同步Url?
            <button id="yes" type="button" class="btn  btn-success">是</button>
            <button id="no" type="button" class="btn  btn-danger">否</button>
        </div>
    </div>

    <div id="explode" class="panel panel-default" style="display:none;">
        <div class="panel-body">
            是否需要导出execl?
            <button id="y_execl" type="button" class="btn  btn-success">是</button>
            <button id="n_execl" type="button" class="btn  btn-danger">否</button>
        </div>
    </div>

{% endblock %}

{% block javascripts %}
    <script type="text/javascript">
        var startTime = "";
        var endTime = "";
        $(function () {
            $('input[name="daterange"]').daterangepicker({
                locale: {
                    format: 'YYYY/MM/DD'
                }
            }, function (start, end, label) {
                startTime = start.format('YYYY:MM:DD');
                endTime = end.format('YYYY:MM:DD');
            });
        });
        var progress_val = 0;
        var progressUp;
        var lenstenPro = setInterval(function () {
            if (progress_val >= 80) {
                clearInterval(progressUp);
            }
        }, 1000);
        $(document).ajaxStart(function () {
            $(".progress").show();
            //ajax 开始后每秒执行一次修改进度条
            progressUp = setInterval(function () {
                progress_val = progress_val + (Math.random() * 10);
                $(".progress-bar").width(progress_val + "%");
            }, 1000);
        }).ajaxStop(function () {
            $(".progress-bar").width("100%");
            clearInterval(progressUp);
            clearInterval(lenstenPro);
            setTimeout(function () {
                progress_val = 0
                $(".progress-bar").width("0%");
                $(".progress").hide();
            }, 5000);
        });

        $("#gotoCatch").click(function () {
            var keyword = $("#keyword").val();
            var pagesize = $("#pagesize").val();
            $.post("{{ path('purchase_list') }}", {keyword: keyword, start: startTime, end: endTime, pagesize: pagesize}, function (data) {
                if (data == "insert finish") {
                    $("#msg_hint").html("所有链接均已录入数据库");
                    $("#msg_hint").show();
                    $("#confirm").show();
                    setTimeout(function () {
                        $("#msg_hint").hide();
                    }, 2000);
                }
            });
        });

        $("#yes").click(function () {
            $.get("{{ path('purchase_info') }}", function (data) {
                if (data == "insert finish") {
                    $("#msg_hint").html("所有数据已同步");
                    $("#msg_hint").show();
                    $("#explode").show();
                    setTimeout(function () {
                        $("#msg_hint").hide();
                        $("#confirm").hide();
                    }, 2000);
                }
            });
        });

        $("#y_execl").click(function () {
            window.open("{{ path('purchase_export') }}", "_blank");
        });


    </script>
{% endblock %}